<!-- Dacio -->

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Direto de PDFs - Positivo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        footer {
            color: #000000;
            padding: 20px;
            text-align: center;
            margin-top: 50px;
        }
        textarea {
            width: 98%;
            height: 200px;
            margin-bottom: 15px;
            padding: 7.5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .limpar {
            background-color: rgba(255, 0, 0, 0.788);
        }
        button:hover {
            background-color: #45a049;
        }
        #baixarTodos, .btn-6000:hover {
            background-color: #2196F3;
        }
        #baixarTodos:hover {
            background-color: #0b7dda;
        }
        .buttons-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 15px;
        }
        .btn-50013 {
            background-color: #4CAF50;
            color: white;
        }
        .btn-6000 {
            background-color: #007BFF;
            color: white;
        }
        .limpar:hover {
            background-color: #666;
        }
        .info {
            background-color: #e7f3fe;
            padding: 10px;
            border-left: 5px solid #2196F3;
            margin-bottom: 15px;
        }
        #status {
            margin-top: 15px;
            font-weight: bold;
        }
        button:disabled {
            background-color: #ccc !important;
            color: #666 !important;
            cursor: not-allowed !important;
        }
        .bm {
            background-color: #f1efef;
            display:inline-block; 
            padding:10px 14px; 
            border-radius:10px; 
            text-decoration:none; 
            border:1px solid #ddd;
        }
        .bm:hover{
            background:#f7f7f7
        }
        .bm-note{
            font-size:13px;
        }
        details {
            background: #ffffff;
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-bottom: 3px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        details summary {
        background-color: #ccc;
        color: black;
        padding: 10px 14px;
        cursor: pointer;
        
        }
        details summary:hover {
        background-color: #ffffff;
        }
    </style>
</head>
<body>
    <h1>Download de PDFs - Assist</h1>
    
    <details>
        <summary>Instru√ß√µes</summary>
    
    <div class="info">
        <p><strong>Instru√ß√µes:</strong></p>
        <ol>
            <li>Fa√ßa login no site <strong>Assist</strong> normalmente. Depois, em uma nova guia utilize a ferramenta.</li>
            <li>Cole as ordens no campo abaixo <code>(separadas por v√≠rgula ou linha)</code>.</li>
            <li>Clique em <strong>"Gerar Links"</strong> para validar as ordens.</li>
            <li>Use <strong>"Baixar Todos"</strong> para abrir os PDFs em sequ√™ncia (salve manualmente em cada aba).</li>
        </ol>
        <p><strong>Nota:</strong> O Navegador pode bloquear a abertura de pop-ups. Verique e permita caso n√£o abra todas as guias.</p>
        <p><strong>Nota¬≤:</strong> O sistema n√£o gera PDFs de chamados iniciados em 6000 ou 20001, apenas direciona para a aba de pesquisa do ASSIST.</p>
    </div>
    </details>

    <details>
    <summary>Atalhos para fazer laudo</summary>
<div class="info">

  <div>
    <a class="bm" title="Arraste para os favoritos"
href="javascript:(async function(){ function getTextFromRow(label){     var row = Array.from(document.querySelectorAll('tr.link1')).find(tr=>{         return (tr.innerText||'').toLowerCase().includes(label.toLowerCase());     });     if(!row) return '';     var tds = row.querySelectorAll('td');     if(tds.length < 2) return tds[0]?.innerText.trim()%20||%20%27%27;%20%20%20%20%20return%20tds[1].innerText.trim();%20}%20%20%20%20var%20data%20=%20{%20%20%20%20%20ordemServico:%20getTextFromRow(%27Ordem%20de%20Servi%C3%A7o%27).replace(/\D/g,%27%27),%20%20%20%20%20osCliente:%20%270%27,%20%20%20%20%20agencia:%20%270%27,%20%20%20%20%20segmento:%20%27Governo%27,%20%20%20%20%20projeto:%20getTextFromRow(%27PEP%27),%20%20%20%20%20nomeCliente:%20getTextFromRow(%27Nome%20do%20Consumidor%27).replace(/\(Ver.*\)/,%27%27).trim(),%20%20%20%20%20responsavel:%20getTextFromRow(%27Nome%20do%20Consumidor%27).replace(/\(Ver.*\)/,%27%27).trim(),%20%20%20%20%20cnpj:%20getTextFromRow(%27CPF/CNPJ%27),%20%20%20%20%20uf:%20%27SP%27,%20%20%20%20%20serial:%20getTextFromRow(%27Serial%27),%20%20%20%20%20sku:%20getTextFromRow(%27SKU%27),%20%20%20%20%20email:%20getTextFromRow(%27E-mail%27)%20%20%20};%20%20%20%20try{%20%20%20%20%20await%20navigator.clipboard.writeText(JSON.stringify(data));%20%20%20%20%20alert(%27%E2%9C%85%20Dados%20copiados%20para%20a%20%C3%A1rea%20de%20transfer%C3%AAncia:\n\n%27%20+%20JSON.stringify(data,null,2));%20%20%20}catch(e){%20%20%20%20%20alert(%27%E2%9A%A0%EF%B8%8F%20N%C3%A3o%20consegui%20acessar%20o%20clipboard.\nCopie%20manualmente%20este%20texto:\n\n%27%20+%20JSON.stringify(data,null,2));%20%20%20}%20})();">
      üìã Copiar Assist
    </a>

    <a class="bm" title="Arraste para os favoritos"
href="javascript:(async function(){   function setIfExists(sel,val){     var el=document.querySelector(sel);     if(!el) return;     el.value=val;     el.dispatchEvent(new Event('change',{bubbles:true}));     el.dispatchEvent(new Event('input',{bubbles:true}));   }    let text = '';   try{     text = await navigator.clipboard.readText();   }catch(e){     alert('%E2%9A%A0%EF%B8%8F N%C3%A3o consegui ler do clipboard. Tente colar manualmente.');     return;   }    let data = {};   try{     data = JSON.parse(text);   }catch(e){     alert('%E2%9A%A0%EF%B8%8F O que est%C3%A1 no clipboard n%C3%A3o %C3%A9 v%C3%A1lido.\nConte%C3%BAdo:\n' + text);     return;   }    setIfExists('#numberOs',%20data.ordemServico);%20%20%20setIfExists('#osCliente',%20data.osCliente);%20%20%20setIfExists('#cgcAgencia',%20data.agencia);%20%20%20setIfExists('#segmento',%20data.segmento);%20%20%20setIfExists('#pep',%20data.projeto);%20%20%20setIfExists('#clientDetent',%20data.nomeCliente);%20%20%20setIfExists('#respTec',%20data.responsavel);%20%20%20setIfExists('#respTecCpf',%20data.cnpj);%20%20%20setIfExists('#clientUf',%20data.uf);%20%20%20setIfExists('#serialNumber',%20data.serial);%20%20%20setIfExists('#sku',%20data.sku);%20%20%20setIfExists('#contactEmail',%20data.email);%20%20%20%20%20var%20falha=document.querySelector('#falhaDiagnostico');%20%20%20if(falha){%20%20%20%20%20Array.from(falha.options).forEach(function(o){%20%20%20%20%20%20%20if(o.text.toLowerCase().includes('uso%20inadequado'))%20o.selected=true;%20%20%20%20%20});%20%20%20}%20%20%20%20alert('%E2%9C%85%20Formul%C3%A1rio%20preenchido%20com%20os%20dados%20copiados!');%20})();">
      üìù Colar ATP
    </a>

    <a class="bm" title="Arraste para os favoritos"
href="javascript:document.querySelector('select[name=&quot;lacre&quot;]').value='L';var d=new Date();document.querySelector('input[name=&quot;dataInicio&quot;]').value=d.getDate().toString().padStart(2,'0')+'/'+(d.getMonth()+1).toString().padStart(2,'0')+'/'+d.getFullYear();document.querySelector('input[name=&quot;horaInicio&quot;]').value=d.getHours().toString().padStart(2,'0')+':'+d.getMinutes().toString().padStart(2,'0');document.querySelector('textarea[name=&quot;observacao&quot;]').value='Efetuado Laudo T%C3%A9cnico';void(0);">
      üîß Preencher conserto
    </a>
  </div>

  <p class="bm-note">Como usar: ative a barra de favoritos (Ctrl+Shift+B), <b>arraste</b> os bot√µes acima para a barra e clique neles nas p√°ginas certas.</p>
</div>
</details>

    <textarea id="ordensInput" placeholder="Cole as ordens aqui, separadas por v√≠rgula ou linha. Exemplo:
50013214520
60006022631
20001234567
80013214520"></textarea>

    <button onclick="gerarLinks()">Gerar Links</button>
    <button id="baixarTodos" onclick="baixarTodos()" disabled>Abrir Todos</button>
    <button class="limpar" onclick="limparTudo()" disabled>Limpar Tudo</button>

    <div id="buttonsContainer" class="buttons-container"></div>
    <div id="status"></div>

<script>
  const inputArea = document.getElementById("ordensInput");
  const btnBaixarTodos = document.getElementById("baixarTodos");
  const btnLimpar = document.querySelector(".limpar");
  const container = document.getElementById("buttonsContainer");
  const statusEl = document.getElementById("status");

  let ordensList = [];
  let chamadosPDF = [];     // 50013 e 80013
  let chamadosAssist = [];  // 6000 e 20001

  function abrirAssistAutomaticamente(callback) {
    const assistUrl = "https://assist.positivotecnologia.com.br/bin/login_destino.php";
    const win = window.open(
      assistUrl,
      "assistAuto",
      "width=200,height=120,left=-10000,top=-10000"
    );

    if (!win || win.closed) {
      callback();
      return;
    }

    setTimeout(() => {
      try { win.close(); } catch (e) {}
      callback();
    }, 100);
  }

  function gerarLinks() {
    abrirAssistAutomaticamente(() => {
      const input = inputArea.value.trim();
      if (!input) {
          alert("Insira os chamados.");
          return;
      }

      ordensList = input.split(/[\s,]+/)
                       .map(s => s.trim().replace(/\D/g, ''))
                       .filter(Boolean);

      container.innerHTML = "";
      chamadosPDF = [];
      chamadosAssist = [];
      const chamadosInvalidos = [];

      ordensList.forEach(os => {
          if (os.length !== 11) {
              chamadosInvalidos.push(os);
              return;
          }

          // Identifica padr√£o
          if (os.startsWith("50013") || os.startsWith("80013")) {
              chamadosPDF.push(os);
          } else if (os.startsWith("6000") || os.startsWith("20001")) {
              chamadosAssist.push(os);
          } else {
              chamadosInvalidos.push(os);
          }
      });

      // Cria bot√µes PDF (links diretos)
      chamadosPDF.forEach(os => {
          const button = document.createElement("button");
          const osId = os.substring(3);
          button.className = "btn-50013";
          button.textContent = `PDF ${os}`;
          button.onclick = () => {
              const url = `https://assist.positivotecnologia.com.br/bin/at/comprovantes/gerarRatPdf.php?os_id=${osId}&mostraStatus=1`;
              window.open(url, "_blank");
          };
          container.appendChild(button);
      });

      // Cria bot√µes Assist (pesquisa)
      chamadosAssist.forEach(os => {
          const button = document.createElement("button");
          button.className = "btn-6000";
          button.textContent = `Assist ${os}`;
          button.onclick = () => {
              const url = `https://assist.positivotecnologia.com.br/bin/at/pesq_os.php?CHAMADO_NUMERO=${os}`;
              window.open(url, "_blank");
          };
          container.appendChild(button);
      });

      // Exibe estat√≠sticas
      let statusMessage = `${chamadosPDF.length} PDFs e ${chamadosAssist.length} link(s) Assist gerado(s).`;
      if (chamadosInvalidos.length > 0) {
          statusMessage += ` ${chamadosInvalidos.length} chamado(s) inv√°lido(s).`;
          const invalidosDiv = document.createElement("div");
          invalidosDiv.style.marginTop = "10px";
          invalidosDiv.style.color = "#ff5722";
          invalidosDiv.textContent = `Inv√°lidos: ${chamadosInvalidos.join(", ")}`;
          container.appendChild(invalidosDiv);
      }

      statusEl.textContent = statusMessage;
      btnBaixarTodos.disabled = false;
      btnLimpar.disabled = false;
    });
  }

  function baixarTodos() {
      const total = chamadosPDF.length + chamadosAssist.length;
      if (total === 0) {
          alert("Nenhum chamado v√°lido para processar. Verifique os n√∫meros inseridos.");
          return;
      }

      if (!confirm(`Abrir ${total} abas para chamados v√°lidos?`)) return;

      const todosEmOrdem = chamadosPDF.concat(chamadosAssist);
      todosEmOrdem.forEach((os) => {
          setTimeout(() => {
              if (os.startsWith("50013") || os.startsWith("80013")) {
                  const osId = os.substring(3);
                  const url = `https://assist.positivotecnologia.com.br/bin/at/comprovantes/gerarRatPdf.php?os_id=${osId}&mostraStatus=1`;
                  window.open(url, "_blank");
              } else if (os.startsWith("6000") || os.startsWith("20001")) {
                  const url = `https://assist.positivotecnologia.com.br/bin/at/pesq_os.php?CHAMADO_NUMERO=${os}`;
                  window.open(url, "_blank");
              }
          });
      });
  }

  function limparTudo() {
      inputArea.value = "";
      container.innerHTML = "";
      statusEl.textContent = "";
      ordensList = [];
      chamadosPDF = [];
      chamadosAssist = [];
      btnBaixarTodos.disabled = true;
      btnLimpar.disabled = true;
  }

  inputArea.addEventListener("input", () => {
    const temTexto = inputArea.value.trim().length > 0;
    btnLimpar.disabled = !temTexto;
  });
</script>

</body>
<footer>
    <p>Desenvolvido por Vinicius D√°cio</p>
</footer>
</html>
